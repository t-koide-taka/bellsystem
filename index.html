<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>見積もりシミュレーター</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { 
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', 'Yu Gothic', sans-serif; 
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="padding: 20px; text-align: center;">
            <p>読み込み中...</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState } = React;

        function EstimateSimulator() {
            // 基本データ
            const months = ['7月', '8月', '9月', '10月', '11月', '12月', '1月', '2月', '3月', '4月', '5月', '6月'];
            const businessDays = [22, 20, 20, 22, 18, 20, 19, 18, 21, 21, 18, 22];
            const workingHours = [176, 160, 160, 176, 144, 160, 152, 144, 168, 168, 144, 176];
            
            const prices = {
                'MGR': 120000,
                'SV': 2700,
                'LD': 2380,
                'CM': 2160,
                'SV残業': 2810,
                'LD残業': 2705,
                'CM残業': 2380,
                '採用費': 100000,
                'ブース利用料': 45000
            };

            // 元の見積額
            const originalTotal = 155153573;
            const targetReduction = 5000000;
            const originalMonthlyEstimates = [8893013, 8492155, 8751355, 10760473, 9278415, 13629887, 16485559, 18536784, 19942290, 19459082, 11726997, 9197563];

            // 状態管理
            const [staffPlan, setStaffPlan] = useState({
                'MGR': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                'SV': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                'LD': [3, 3, 3, 3, 3, 4, 5, 6, 6, 6, 4, 3],
                'CM': [14, 14, 14, 17, 16, 22, 27, 34, 32, 31, 21, 14]
            });

            const [requestSeats] = useState([18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18]);

            // ブース利用数の設定（実際のExcelデータから）
            const [boothCounts, setBoothCounts] = useState([18, 18, 18, 21, 20, 27, 33, 41, 39, 38, 26, 18]);
            const defaultBoothCounts = [18, 18, 18, 21, 20, 27, 33, 41, 39, 38, 26, 18];
            const boothUnitPrice = 45000;

            // 繁忙期手当設定（月ごとの個別設定）
            const [busySeasonAllowances, setBusySeasonAllowances] = useState({
                0: 0,   // 7月
                1: 0,   // 8月
                2: 0,   // 9月
                3: 0,   // 10月
                4: 0,   // 11月
                5: 0,   // 12月
                6: 150, // 1月 (デフォルト150円)
                7: 150, // 2月
                8: 150, // 3月
                9: 150, // 4月
                10: 150, // 5月
                11: 0   // 6月
            });

            // 各月の繁忙期手当時間数（実際のExcelデータから）
            const busySeasonHours = {
                0: 0,    // 7月
                1: 0,    // 8月
                2: 0,    // 9月
                3: 0,    // 10月
                4: 0,    // 11月
                5: 0,    // 12月
                6: 4543, // 1月
                7: 5395, // 2月
                8: 6932, // 3月
                9: 6759, // 4月
                10: 3984, // 5月
                11: 0    // 6月
            };

            // 月別見積額計算
            const calculateMonthlyEstimate = (monthIndex) => {
                const baselineAmount = originalMonthlyEstimates[monthIndex];
                const baselineStaff = {
                    'MGR': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                    'SV': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                    'LD': [3, 3, 3, 3, 3, 4, 5, 6, 6, 6, 4, 3],
                    'CM': [14, 14, 14, 17, 16, 22, 27, 34, 32, 31, 21, 14]
                };
                const baselineSeats = 18;
                const baselineBoothCount = defaultBoothCounts[monthIndex];
                const baselineBusyAllowance = monthIndex >= 6 && monthIndex <= 10 ? 150 : 0; // 元の設定
                
                // 現在の設定での繁忙期手当
                const currentBusyAllowance = busySeasonAllowances[monthIndex] || 0;
                
                let difference = 0;
                
                const mgrDiff = staffPlan.MGR[monthIndex] - baselineStaff.MGR[monthIndex];
                difference += mgrDiff * prices.MGR;
                
                const svDiff = staffPlan.SV[monthIndex] - baselineStaff.SV[monthIndex];
                const svBaseCost = prices.SV * workingHours[monthIndex] * 1.1 + 35 * prices['SV残業'];
                difference += svDiff * svBaseCost;
                
                const ldDiff = staffPlan.LD[monthIndex] - baselineStaff.LD[monthIndex];
                const ldBaseCost = prices.LD * workingHours[monthIndex] * 1.1 + 20 * prices['LD残業'];
                difference += ldDiff * ldBaseCost;
                
                const cmDiff = staffPlan.CM[monthIndex] - baselineStaff.CM[monthIndex];
                const cmBaseCost = prices.CM * workingHours[monthIndex] * 1.1 + 5 * prices['CM残業'];
                difference += cmDiff * cmBaseCost;
                
                const seatsDiff = requestSeats[monthIndex] - baselineSeats;
                difference += seatsDiff * 11500; // 設備費のみ
                
                // ブース利用料差分（ブース数 × 単価の差分）
                const boothCountDiff = boothCounts[monthIndex] - baselineBoothCount;
                difference += boothCountDiff * boothUnitPrice;
                
                // 繁忙期手当差分（時間数 × 単価の差分）
                const busyHours = busySeasonHours[monthIndex] || 0;
                const busyAllowanceDiff = (currentBusyAllowance - baselineBusyAllowance) * busyHours;
                difference += busyAllowanceDiff;
                
                if (cmDiff > 0) {
                    difference += cmDiff * prices['採用費'];
                }
                
                return Math.round(baselineAmount + difference);
            };

            const calculateTotalEstimate = () => {
                return months.reduce((total, _, index) => total + calculateMonthlyEstimate(index), 0);
            };

            const currentTotal = calculateTotalEstimate();
            const totalReduction = originalTotal - currentTotal;
            const reductionPercentage = (totalReduction / targetReduction * 100).toFixed(1);

            // ハンドラー関数
            const handleStaffChange = (role, monthIndex, value) => {
                const newStaffPlan = { ...staffPlan };
                newStaffPlan[role][monthIndex] = Math.max(0, parseInt(value) || 0);
                setStaffPlan(newStaffPlan);
            };

            const handleBusyAllowanceChange = (monthIndex, value) => {
                setBusySeasonAllowances(prev => ({
                    ...prev,
                    [monthIndex]: Math.max(0, parseInt(value) || 0)
                }));
            };

            // ブース数変更ハンドラー
            const handleBoothCountChange = (monthIndex, value) => {
                const newBoothCounts = [...boothCounts];
                newBoothCounts[monthIndex] = Math.max(0, parseInt(value) || 0);
                setBoothCounts(newBoothCounts);
            };

            // 数値フォーマット
            const formatNumber = (num) => {
                return new Intl.NumberFormat('ja-JP').format(num);
            };

            // A4サマリーPDF出力関数
            const generatePDF = () => {
                const pdfWindow = window.open('', '_blank');
                
                // 月別データの計算
                const monthlyData = months.map((month, index) => ({
                    month,
                    amount: calculateMonthlyEstimate(index),
                    originalAmount: originalMonthlyEstimates[index],
                    boothCount: boothCounts[index]
                }));
                
                // 最大値の計算（棒グラフの高さ調整用）
                const maxAmount = Math.max(...monthlyData.map(d => d.amount));
                
                // リスク評価の計算
                const riskEvaluation = () => {
                    const baselineStaff = {
                        'MGR': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                        'SV': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                        'LD': [3, 3, 3, 3, 3, 4, 5, 6, 6, 6, 4, 3],
                        'CM': [14, 14, 14, 17, 16, 22, 27, 34, 32, 31, 21, 14]
                    };
                    
                    const totalReductions = Object.entries(staffPlan).map(([role, counts]) => {
                        const totalCurrent = counts.reduce((sum, count) => sum + count, 0);
                        const totalBaseline = baselineStaff[role].reduce((sum, count) => sum + count, 0);
                        const reductionRate = ((totalBaseline - totalCurrent) / totalBaseline * 100);
                        return { role, reductionRate, totalCurrent, totalBaseline };
                    });
                    
                    const hasHighRisk = totalReductions.some(r => r.reductionRate > 25);
                    const hasMediumRisk = totalReductions.some(r => r.reductionRate > 10);
                    
                    return { totalReductions, hasHighRisk, hasMediumRisk };
                };
                
                const { totalReductions, hasHighRisk, hasMediumRisk } = riskEvaluation();
                
                pdfWindow.document.write(`
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>見積書サマリー 2025年度</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @page {
            size: A4;
            margin: 15mm;
        }
        
        body {
            font-family: 'Noto Sans JP', 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
            background: white;
            width: 210mm;
            height: 297mm;
            padding: 15mm;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .page-header {
            text-align: center;
            border-bottom: 3px solid #2c5282;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: #2c5282;
            margin-bottom: 5px;
        }
        
        .page-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .issue-date {
            font-size: 11px;
            color: #999;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c5282;
            margin-bottom: 12px;
            padding-left: 10px;
            border-left: 4px solid #2c5282;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .kpi-card {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            position: relative;
        }
        
        .kpi-card.primary {
            background: #ebf8ff;
            border-color: #3182ce;
        }
        
        .kpi-card.success {
            background: #f0fff4;
            border-color: #38a169;
        }
        
        .kpi-card.warning {
            background: #fffaf0;
            border-color: #dd6b20;
        }
        
        .kpi-card.danger {
            background: #fed7d7;
            border-color: #e53e3e;
        }
        
        .kpi-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .kpi-value {
            font-size: 20px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 3px;
        }
        
        .kpi-change {
            font-size: 10px;
            color: #666;
        }
        
        .monthly-chart {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .chart-container {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        
        .month-column {
            text-align: center;
        }
        
        .month-label {
            font-size: 10px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .month-bar {
            background: #e2e8f0;
            border-radius: 4px;
            position: relative;
            margin-bottom: 5px;
            height: 80px;
            display: flex;
            align-items: flex-end;
        }
        
        .month-bar-fill {
            width: 100%;
            border-radius: 4px;
            background: linear-gradient(to top, #3182ce, #63b3ed);
            transition: all 0.3s ease;
            position: relative;
            min-height: 15px;
        }
        
        .month-bar-fill.peak {
            background: linear-gradient(to top, #e53e3e, #fc8181);
        }
        
        .month-value {
            font-size: 9px;
            color: #2d3748;
            font-weight: 600;
            writing-mode: vertical-lr;
            text-orientation: mixed;
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .risk-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .risk-category {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #718096;
        }
        
        .risk-category.high {
            border-left-color: #e53e3e;
            background: #fed7d7;
        }
        
        .risk-category.medium {
            border-left-color: #dd6b20;
            background: #fef5e7;
        }
        
        .risk-category.low {
            border-left-color: #38a169;
            background: #f0fff4;
        }
        
        .risk-title {
            font-size: 13px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }
        
        .risk-item {
            font-size: 11px;
            color: #4a5568;
            margin-bottom: 4px;
            padding-left: 8px;
            position: relative;
        }
        
        .risk-item::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #a0aec0;
        }
        
        .summary-box {
            background: #2c5282;
            color: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-top: 20px;
        }
        
        .summary-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .summary-content {
            font-size: 11px;
            line-height: 1.5;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        @media print {
            body {
                box-shadow: none;
                width: auto;
                height: auto;
                padding: 0;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="page-header">
        <div class="page-title">サポート業務見積サマリー</div>
        <div class="page-subtitle">2025年度（2025年7月 - 2026年6月）</div>
        <div class="issue-date">発行日: ${new Date().toLocaleDateString('ja-JP')}</div>
    </div>
    
    <div class="section">
        <div class="section-title">📊 見積概要</div>
        <div class="kpi-grid">
            <div class="kpi-card primary">
                <div class="kpi-label">現在の見積額</div>
                <div class="kpi-value">¥${(currentTotal / 1000000).toFixed(1)}M</div>
                <div class="kpi-change">年間総額</div>
            </div>
            <div class="kpi-card ${totalReduction > 0 ? 'success' : 'danger'}">
                <div class="kpi-label">削減額</div>
                <div class="kpi-value">¥${(totalReduction / 1000000).toFixed(1)}M</div>
                <div class="kpi-change">${totalReduction > 0 ? '削減達成' : '削減なし'}</div>
            </div>
            <div class="kpi-card ${reductionPercentage >= 100 ? 'success' : parseFloat(reductionPercentage) > 50 ? 'warning' : 'danger'}">
                <div class="kpi-label">目標達成率</div>
                <div class="kpi-value">${reductionPercentage}%</div>
                <div class="kpi-change">${reductionPercentage >= 100 ? '達成' : '未達成'}</div>
            </div>
            <div class="kpi-card danger">
                <div class="kpi-label">目標削減額</div>
                <div class="kpi-value">¥${(targetReduction / 1000000).toFixed(1)}M</div>
                <div class="kpi-change">要削減</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <div class="section-title">📈 月別見積推移</div>
        <div class="monthly-chart">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <span style="font-size: 13px; font-weight: 600;">月別コスト（百万円）</span>
                <span style="font-size: 11px; color: #666;">最大: ${(maxAmount / 1000000).toFixed(1)}M</span>
            </div>
            <div class="chart-container">
                ${monthlyData.map((data, index) => {
                    const height = (data.amount / maxAmount * 100);
                    const isPeak = index >= 6 && index <= 10; // 1月-5月
                    const amountInM = (data.amount / 1000000).toFixed(1);
                    
                    return `
                    <div class="month-column">
                        <div class="month-label">${data.month}</div>
                        <div class="month-bar">
                            <div class="month-bar-fill ${isPeak ? 'peak' : ''}" style="height: ${height}%;">
                                <div class="month-value">${amountInM}</div>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('')}
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(to top, #3182ce, #63b3ed);"></div>
                    <span>通常期</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(to top, #e53e3e, #fc8181);"></div>
                    <span>繁忙期（手当込み）</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <div class="section-title">⚠️ リスク評価</div>
        <div class="risk-grid">
            <div class="risk-category ${hasHighRisk ? 'high' : hasMediumRisk ? 'medium' : 'low'}">
                <div class="risk-title">${hasHighRisk ? '🔴 高リスク' : hasMediumRisk ? '🟡 中リスク' : '🟢 低リスク'}</div>
                ${totalReductions.filter(r => r.reductionRate > 0).map(r => 
                    `<div class="risk-item">${r.role}: ${r.reductionRate.toFixed(1)}%削減 (${r.totalCurrent}/${r.totalBaseline}名)</div>`
                ).join('')}
                ${totalReductions.filter(r => r.reductionRate > 0).length === 0 ? 
                    '<div class="risk-item">人員削減なし - 適正配置</div>' : ''}
            </div>
            <div class="risk-category medium">
                <div class="risk-title">🟡 運用リスク</div>
                <div class="risk-item">繁忙期手当: ¥${formatNumber(
                    Object.keys(busySeasonHours).reduce((total, monthIndex) => {
                        const hours = busySeasonHours[monthIndex] || 0;
                        const allowance = busySeasonAllowances[monthIndex] || 0;
                        return total + (hours * allowance);
                    }, 0)
                )}</div>
                <div class="risk-item">最大ブース数: ${Math.max(...boothCounts)}ブース</div>
                <div class="risk-item">月間変動率: ${((maxAmount / Math.min(...monthlyData.map(d => d.amount))) * 100 - 100).toFixed(0)}%</div>
            </div>
            <div class="risk-category low">
                <div class="risk-title">🟢 安定要素</div>
                <div class="risk-item">管理体制: MGR・SV確保</div>
                <div class="risk-item">基本単価: 据え置き</div>
                <div class="risk-item">通信インフラ: 安定</div>
            </div>
            <div class="risk-category medium">
                <div class="risk-title">💡 改善提案</div>
                <div class="risk-item">繁忙期の人員配置最適化</div>
                <div class="risk-item">AI・自動化による効率化</div>
                <div class="risk-item">段階的コスト削減計画</div>
                <div class="risk-item">ブース利用率の最適化</div>
            </div>
        </div>
    </div>
    
    <div class="summary-box">
        <div class="summary-title">総合評価</div>
        <div class="summary-content">
            現在の見積額¥${(currentTotal / 1000000).toFixed(1)}Mは${totalReduction >= 0 ? `原案から¥${(totalReduction / 1000000).toFixed(1)}M削減` : `原案を¥${(Math.abs(totalReduction) / 1000000).toFixed(1)}M超過`}しています。<br>
            ${totalReduction >= targetReduction 
                ? `目標削減額を達成し、追加で¥${((totalReduction - targetReduction) / 1000000).toFixed(1)}Mの削減効果があります。` 
                : `目標達成まで¥${((targetReduction - totalReduction) / 1000000).toFixed(1)}Mの追加削減が必要です。`}<br>
            <strong>推奨アクション:</strong> ${hasHighRisk ? '段階的削減とリスク軽減策の実施' : hasMediumRisk ? '品質モニタリング強化' : '現行プランでの実行可能'}</div>
    </div>
</body>
</html>
                `);
                
                pdfWindow.document.close();
                
                // PDFダイアログを自動で開く
                setTimeout(() => {
                    pdfWindow.print();
                }, 500);
            };

            // リスク評価関数
            const getRiskLevel = (rate) => {
                if (rate <= 0) return { level: 'なし', color: 'bg-green-100 text-green-800 border-green-200', icon: '✅' };
                if (rate <= 10) return { level: '低', color: 'bg-yellow-100 text-yellow-800 border-yellow-200', icon: '⚠️' };
                if (rate <= 25) return { level: '中', color: 'bg-orange-100 text-orange-800 border-orange-200', icon: '⚡' };
                return { level: '高', color: 'bg-red-100 text-red-800 border-red-200', icon: '🚨' };
            };

            const getRiskContent = (role, rate) => {
                if (rate <= 0) return ['リスクなし - 適正な人員配置です'];
                
                const riskMap = {
                    'MGR': [
                        '• 戦略策定・方針決定の遅延',
                        '• KPI管理・進捗確認の不備',
                        '• 契約交渉・営業対応の支障',
                        '• チーム統制・人事管理のリスク'
                    ],
                    'SV': [
                        '• 現場マネジメント不足',
                        '• LD・CM育成プランの遅延',
                        '• 重要案件・個別相談対応の支障',
                        '• 品質管理・報告業務の不備'
                    ],
                    'LD': [
                        '• CMフォロー・指導不足',
                        '• KPI管理（1on1、FB）の頻度低下',
                        '• 新人育成・OJTの質低下',
                        '• エスカレーション対応遅延'
                    ],
                    'CM': [
                        '• コール・メール応答率の低下',
                        '• 顧客待ち時間の増加',
                        '• 一次対応品質の低下',
                        '• 顧客満足度への影響'
                    ]
                };
                
                return riskMap[role] || ['• 業務品質への影響'];
            };

            const roleDisplayNames = {
                'MGR': 'MGR＝1式',
                'SV': 'SV＝B',
                'LD': 'LD＝B',
                'CM': 'CM＝B'
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-6">
                    <div className="max-w-7xl mx-auto">
                        {/* ヘッダー */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100">
                            <h1 className="text-3xl font-bold text-gray-800 mb-4">📊 見積もりシミュレーター</h1>
                            
                            {/* サマリー */}
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-xl">
                                    <div className="text-sm opacity-90 mb-1">📈 現在の見積額</div>
                                    <div className="text-2xl font-bold">¥{formatNumber(currentTotal)}</div>
                                </div>
                                
                                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl">
                                    <div className="text-sm opacity-90 mb-1">📉 削減額</div>
                                    <div className="text-2xl font-bold">¥{formatNumber(totalReduction)}</div>
                                </div>
                                
                                <div className="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-xl">
                                    <div className="text-sm opacity-90 mb-1">🎯 目標達成率</div>
                                    <div className="text-2xl font-bold">{reductionPercentage}%</div>
                                </div>
                                
                                <div className="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 rounded-xl">
                                    <div className="text-sm opacity-90 mb-1">🎯 目標削減額</div>
                                    <div className="text-2xl font-bold">¥{formatNumber(targetReduction)}</div>
                                </div>
                            </div>
                        </div>

                        {/* 繁忙期手当設定 */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">🎯 繁忙期手当設定（月別）</h2>
                            
                            {/* 月別設定グリッド */}
                            <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                {months.map((month, index) => {
                                    const hours = busySeasonHours[index] || 0;
                                    const allowance = busySeasonAllowances[index] || 0;
                                    const totalAmount = hours * allowance;
                                    const isActive = hours > 0;
                                    
                                    return (
                                        <div key={index} className={`p-4 rounded-xl border-2 ${
                                            isActive ? 'bg-orange-50 border-orange-200' : 'bg-gray-50 border-gray-200'
                                        }`}>
                                            <div className="text-center mb-2">
                                                <div className="font-bold text-lg">{month}</div>
                                                {isActive && (
                                                    <div className="text-xs text-gray-600">{formatNumber(hours)}時間</div>
                                                )}
                                            </div>
                                            
                                            <div className="space-y-2">
                                                <label className="block text-xs font-semibold text-gray-700">
                                                    単価（円/時間）
                                                </label>
                                                <input
                                                    type="number"
                                                    value={allowance}
                                                    onChange={(e) => handleBusyAllowanceChange(index, e.target.value)}
                                                    className="w-full p-2 text-sm border rounded"
                                                    min="0"
                                                    placeholder="0"
                                                    disabled={!isActive}
                                                />
                                                
                                                {isActive && (
                                                    <div className="text-center">
                                                        <div className="text-xs text-gray-600">月額</div>
                                                        <div className="font-bold text-sm text-orange-700">
                                                            ¥{formatNumber(totalAmount)}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            
                            {/* 合計表示 */}
                            <div className="mt-4 p-3 bg-blue-50 rounded-lg">
                                <div className="text-sm font-semibold text-gray-700 mb-2">📊 繁忙期手当合計</div>
                                <div className="text-lg font-bold text-blue-700">
                                    年間合計: ¥{formatNumber(
                                        Object.keys(busySeasonHours).reduce((total, monthIndex) => {
                                            const hours = busySeasonHours[monthIndex] || 0;
                                            const allowance = busySeasonAllowances[monthIndex] || 0;
                                            return total + (hours * allowance);
                                        }, 0)
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* 月別詳細テーブル */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">月別見積詳細</h2>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="bg-gray-50">
                                            <th className="text-left p-3 font-semibold border-b">項目</th>
                                            {months.map((month, index) => (
                                                <th key={index} className="text-center p-3 font-semibold border-b min-w-20">{month}</th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td className="p-3 font-medium bg-blue-50">営業日数</td>
                                            {businessDays.map((days, index) => (
                                                <td key={index} className="text-center p-3 border-b">{days}</td>
                                            ))}
                                        </tr>
                                        
                                        {/* 繁忙期手当適用状況 */}
                                        <tr>
                                            <td className="p-3 font-medium bg-orange-50">繁忙期手当</td>
                                            {months.map((_, index) => {
                                                const allowance = busySeasonAllowances[index] || 0;
                                                const hours = busySeasonHours[index] || 0;
                                                const totalAmount = hours * allowance;
                                                const isActive = hours > 0;
                                                
                                                return (
                                                    <td key={index} className="text-center p-2 border-b">
                                                        {isActive ? (
                                                            <div className="text-xs">
                                                                <div className={`px-1 py-1 rounded ${
                                                                    allowance > 0 
                                                                        ? 'bg-orange-200 text-orange-800 font-bold' 
                                                                        : 'bg-gray-100 text-gray-500'
                                                                }`}>
                                                                    ¥{allowance}/h
                                                                </div>
                                                                <div className="text-gray-600 mt-1">
                                                                    ¥{formatNumber(totalAmount)}
                                                                </div>
                                                            </div>
                                                        ) : (
                                                            <span className="px-2 py-1 rounded text-xs bg-gray-100 text-gray-500">
                                                                -
                                                            </span>
                                                        )}
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                        
                                        {/* 人員計画 */}
                                        {Object.entries(staffPlan).map(([role, counts]) => {
                                            const defaultStaff = {
                                                'MGR': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                                                'SV': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                                                'LD': [3, 3, 3, 3, 3, 4, 5, 6, 6, 6, 4, 3],
                                                'CM': [14, 14, 14, 17, 16, 22, 27, 34, 32, 31, 21, 14]
                                            };
                                            
                                            return (
                                                <tr key={role}>
                                                    <td className="p-3 font-medium bg-yellow-50">{roleDisplayNames[role]}</td>
                                                    {counts.map((count, index) => (
                                                        <td key={index} className="text-center p-2 border-b">
                                                            <div className="flex flex-col items-center">
                                                                <input
                                                                    type="number"
                                                                    value={count}
                                                                    onChange={(e) => handleStaffChange(role, index, e.target.value)}
                                                                    className="w-12 text-center border rounded px-1 py-1 text-sm"
                                                                    min="0"
                                                                />
                                                                <span className="text-xs text-gray-400 mt-1">({defaultStaff[role][index]})</span>
                                                            </div>
                                                        </td>
                                                    ))}
                                                </tr>
                                            );
                                        })}
                                        
                                        {/* ブース数 */}
                                        <tr>
                                            <td className="p-3 font-medium bg-blue-50">ブース数</td>
                                            {boothCounts.map((count, index) => (
                                                <td key={index} className="text-center p-2 border-b">
                                                    <div className="flex flex-col items-center">
                                                        <input
                                                            type="number"
                                                            value={count}
                                                            onChange={(e) => handleBoothCountChange(index, e.target.value)}
                                                            className="w-12 text-center border rounded px-1 py-1 text-sm"
                                                            min="0"
                                                        />
                                                        <span className="text-xs text-gray-400 mt-1">({defaultBoothCounts[index]}B)</span>
                                                    </div>
                                                </td>
                                            ))}
                                        </tr>
                                        
                                        {/* ブース利用料 */}
                                        <tr>
                                            <td className="p-3 font-medium bg-blue-50">ブース利用料</td>
                                            {boothCounts.map((count, index) => {
                                                const monthlyBoothCost = count * boothUnitPrice;
                                                const baselineBoothCost = defaultBoothCounts[index] * boothUnitPrice;
                                                const boothCostDiff = monthlyBoothCost - baselineBoothCost;
                                                return (
                                                    <td key={index} className="text-center p-2 border-b">
                                                        <div className="text-xs">
                                                            <div className="font-bold">¥{formatNumber(monthlyBoothCost)}</div>
                                                            {Math.abs(boothCostDiff) > 0 && (
                                                                <div className={`text-xs ${boothCostDiff > 0 ? 'text-red-600' : 'text-green-600'}`}>
                                                                    {boothCostDiff > 0 ? '↑' : '↓'}¥{formatNumber(Math.abs(boothCostDiff))}
                                                                </div>
                                                            )}
                                                        </div>
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                        
                                        {/* 月別見積額 */}
                                        <tr className="bg-purple-50">
                                            <td className="p-3 font-bold">月別見積額</td>
                                            {months.map((_, index) => {
                                                const monthlyAmount = calculateMonthlyEstimate(index);
                                                const originalAmount = originalMonthlyEstimates[index];
                                                const reduction = originalAmount - monthlyAmount;
                                                return (
                                                    <td key={index} className="text-center p-3 border-b">
                                                        <div className="text-sm font-bold">¥{formatNumber(monthlyAmount)}</div>
                                                        {Math.abs(reduction) > 100 && (
                                                            <div className={`text-xs ${reduction > 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                                {reduction > 0 ? '↓' : '↑'}¥{formatNumber(Math.abs(reduction))}
                                                            </div>
                                                        )}
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* リスク評価ボックス */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">人員削減リスク評価</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {Object.entries(staffPlan).map(([role, counts]) => {
                                    const baselineStaff = {
                                        'MGR': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                                        'SV': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                                        'LD': [3, 3, 3, 3, 3, 4, 5, 6, 6, 6, 4, 3],
                                        'CM': [14, 14, 14, 17, 16, 22, 27, 34, 32, 31, 21, 14]
                                    };
                                    
                                    const totalCurrent = counts.reduce((sum, count) => sum + count, 0);
                                    const totalBaseline = baselineStaff[role].reduce((sum, count) => sum + count, 0);
                                    const reductionRate = ((totalBaseline - totalCurrent) / totalBaseline * 100);
                                    
                                    const risk = getRiskLevel(reductionRate);
                                    const riskContent = getRiskContent(role, reductionRate);

                                    return (
                                        <div key={role} className={`border-2 rounded-xl p-4 ${risk.color}`}>
                                            <div className="flex items-center justify-between mb-3">
                                                <div className="flex items-center gap-2">
                                                    <span className="text-lg">{risk.icon}</span>
                                                    <h3 className="font-bold text-lg">{roleDisplayNames[role]}</h3>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-sm opacity-75">削減率</div>
                                                    <div className="font-bold">{reductionRate > 0 ? `${reductionRate.toFixed(1)}%` : '0%'}</div>
                                                </div>
                                            </div>
                                            
                                            <div className="mb-2">
                                                <div className="text-sm font-semibold mb-1">リスクレベル: {risk.level}</div>
                                            </div>
                                            
                                            {reductionRate > 0 && (
                                                <div className="text-sm space-y-1">
                                                    <div className="font-semibold">想定される影響:</div>
                                                    {riskContent.map((content, index) => (
                                                        <div key={index} className="text-xs">{content}</div>
                                                    ))}
                                                </div>
                                            )}
                                            
                                            <div className="mt-2 text-xs opacity-75">
                                                現在: {totalCurrent}名 / 基準: {totalBaseline}名
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            
                            {/* 総合リスク評価 */}
                            <div className="mt-6 p-4 bg-gray-50 rounded-xl">
                                <h3 className="font-bold text-lg mb-2">🎯 総合リスク評価</h3>
                                <div className="text-sm space-y-2">
                                    {(() => {
                                        const totalReductions = Object.entries(staffPlan).map(([role, counts]) => {
                                            const baselineStaff = {
                                                'MGR': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                                                'SV': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                                                'LD': [3, 3, 3, 3, 3, 4, 5, 6, 6, 6, 4, 3],
                                                'CM': [14, 14, 14, 17, 16, 22, 27, 34, 32, 31, 21, 14]
                                            };
                                            const totalCurrent = counts.reduce((sum, count) => sum + count, 0);
                                            const totalBaseline = baselineStaff[role].reduce((sum, count) => sum + count, 0);
                                            return { role, reduction: totalBaseline - totalCurrent };
                                        });
                                        
                                        const hasHighRisk = totalReductions.some(r => (r.reduction / (r.role === 'CM' ? 256 : r.role === 'LD' ? 49 : 12)) > 0.25);
                                        const hasMediumRisk = totalReductions.some(r => (r.reduction / (r.role === 'CM' ? 256 : r.role === 'LD' ? 49 : 12)) > 0.1);
                                        
                                        if (hasHighRisk) {
                                            return (
                                                <div>
                                                    <div className="text-red-700 font-semibold">🚨 高リスク: サービス品質への重大な影響が懸念されます</div>
                                                    <div className="text-sm">• 顧客満足度低下、SLA未達成、品質クレーム増加の可能性</div>
                                                    <div className="text-sm">• 段階的削減やプロセス改善との併用を推奨</div>
                                                </div>
                                            );
                                        }
                                        if (hasMediumRisk) {
                                            return (
                                                <div>
                                                    <div className="text-orange-700 font-semibold">⚡ 中リスク: 業務品質への影響に注意が必要です</div>
                                                    <div className="text-sm">• 密接なモニタリングと品質管理の強化が必要</div>
                                                    <div className="text-sm">• 研修・効率化施策との並行実施を推奨</div>
                                                </div>
                                            );
                                        }
                                        return (
                                            <div>
                                                <div className="text-green-700 font-semibold">✅ 低リスク: 適正な人員配置範囲内です</div>
                                                <div className="text-sm">• サービス品質を維持しながらコスト削減が可能</div>
                                            </div>
                                        );
                                    })()}
                                </div>
                            </div>
                        </div>

                        {/* 削減効果メッセージとPDF出力 */}
                        <div className="mt-6 text-center space-y-4">
                            <div className={`inline-block px-6 py-3 rounded-full text-white font-bold ${
                                totalReduction >= targetReduction ? 'bg-green-500' : 'bg-orange-500'
                            }`}>
                                {totalReduction >= targetReduction 
                                    ? `🎉 目標達成！ ¥${formatNumber(totalReduction - targetReduction)}の追加削減効果` 
                                    : `目標まで ¥${formatNumber(targetReduction - totalReduction)} の削減が必要`
                                }
                            </div>
                            
                            {/* PDF出力ボタン */}
                            <div>
                                <button
                                    onClick={generatePDF}
                                    className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-colors duration-200 flex items-center gap-2 mx-auto"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    📄 A4サマリー出力
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Reactアプリをマウント
        const rootElement = document.getElementById('root');
        if (rootElement) {
            ReactDOM.render(React.createElement(EstimateSimulator), rootElement);
        }
    </script>
</body>
</html>
